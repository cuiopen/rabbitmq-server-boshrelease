# vim: set filetype=yaml :
---
name: rabbitmq-server

properties:
  erlang.version:
    description: >
      Erlang OTP version that will be used for running RabbitMQ.
      We install multiple Erlang OTP versions to test compatibility.
      The default version is what we recommend for production deployments.
    default: "20.0"
  erlang.cookie:
    description: "Erlang cookie required by the nodes and CLI tools to authenticate with one another"
    default: InsecureDefaultCookie

  rabbitmq-server.debug:
    description: "Runs BOSH job scripts in debug mode"
    default: false

  rabbitmq-server.scheduler_bind_type:
    description: >
      Optimizes Erlang VM schedulers spread across CPUs
      The more spread over the hardware the schedulers are, the more resources are available to the runtime system: http://erlang.org/doc/man/erl.html#+sbt
      This configuration option is less important when RabbitMQ nodes have dedicated hosts, but it has a noticeable impact when competing for CPU with other processes
      For RabbitMQ =< 3.6.3, use rabbitmq-server.additional_erlang_args to set the scheduler bind type
      In RabbitMQ =< 3.6.3 stbt is not defined, erl defaults to 'unbound'
    default: "db"
  rabbitmq-server.additional_erl_args:
    description: "Add optional erl args - good for setting flags such as scheduler bind type in =< 3.6.3"
    default: ""

  rabbitmq-server.generic-unix-url:
    description: "URL to Generic UNIX RabbitMQ xz package"
    default: https://github.com/rabbitmq/rabbitmq-server/releases/download/rabbitmq_v3_6_10/rabbitmq-server-generic-unix-3.6.10.tar.xz

  rabbitmq-server.admin_user:
    description: "Admin user with full privileges"
    default: admin
  rabbitmq-server.admin_pass:
    description: "Admin user password"
    default: InsecureDefaultPassword

  rabbitmq-server.mnesia_base:
    description: "All persistent data will be stored here"
    default: /var/vcap/store/rabbitmq-server/mnesia

  rabbitmq-server.vm_memory_high_watermark:
    description: "Maximum memory footprint after which publishers are blocked"
    default: '0.5'
  rabbitmq-server.disk_free_limit:
    description: "Minimum free disk space after which publishers are blocked"
    default: '{mem_relative, 2.0}'

  rabbitmq-trust-store.directory:
    description: "Location of the whitelisted certificates for Trust Store"
    default: /var/vcap/store/rabbitmq-server/trust-store/whitelist

templates:
  bin/pre-start: bin/pre-start
  bin/start: bin/start
  bin/post-start: bin/post-start
  bin/stop: bin/stop
  bin/drain: bin/drain

  debug.erb: debug
  env.erb: env
  rabbitmq.config.erb: rabbitmq.config

packages:
- start-stop-daemon-1.9.18
- erlang-18.3.4.4
- erlang-19.2.3
- erlang-19.2.2
- erlang-19.3
- erlang-19.3.5
- erlang-19.3.6
- erlang-20.0

provides:
- name: rabbitmq-server
  type: rabbitmq-server

consumes:
- name: rabbitmq-server
  type: rabbitmq-server
