[ -z "$DEBUG" ] || set -x

export SERVICE_USER=vcap
export SERVICE_GROUP=vcap

export RUN_DIR=/var/vcap/sys/run/rabbitmq-server
export RABBITMQ_PID_FILE="$RUN_DIR/pid"

export RABBITMQ_SERVER_PACKAGE=/var/vcap/packages/rabbitmq-server
export RABBITMQ_SERVER_PACKAGE_URL="<%= p("rabbitmq-server.generic-unix-url") %>"

export RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS="-setcookie <%= p("erlang.cookie") %>"
export RABBITMQ_CTL_ERL_ARGS="-setcookie <%= p("erlang.cookie") %>"

export RABBITMQ_MNESIA_BASE="<%= p("rabbitmq-server.mnesia_base") %>"
export RABBITMQ_LOG_BASE=/var/vcap/sys/log/rabbitmq-server
export RABBITMQ_CONFIG_FILE=/var/vcap/jobs/rabbitmq-server/rabbitmq
export RABBITMQ_TRUST_STORE_DIRECTORY="<%= p("rabbitmq-trust-store.directory") %>"

export RABBITMQ_PLUGINS="<%= p("rabbitmq-server.plugins").join(" ") %>"

export RABBITMQ_ADMIN_USER="<%= p("rabbitmq-server.admin_user") %>"
export RABBITMQ_ADMIN_PASS="<%= p("rabbitmq-server.admin_pass") %>"

export RABBITMQ_NODENAME="rabbit@<%= "#{spec.name}#{spec.index}" %>"
export RABBITMQ_CLUSTER_NAME="<%= spec.deployment %>"

<%

etc_hosts = link("rabbitmq-server").instances.map do |i|
  "#{i.address} #{i.name}#{i.index}"
end

%>
export ETC_HOSTS="<%= etc_hosts.join("\n") %>"

export ERLANG_COOKIE="<%= p("erlang.cookie") %>"

# erl(1)/erlc(1) require $HOME to be set
[ -n "$HOME" ] || export HOME=/tmp

export PATH="$RABBITMQ_SERVER_PACKAGE/sbin:/var/vcap/packages/erlang-<%= p("erlang.version") %>/bin:$PATH"
